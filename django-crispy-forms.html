
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://dotmobo.github.io/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://dotmobo.github.io/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://dotmobo.github.io/theme/pygments/emacs.min.css">



  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/custom.css">


  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">



<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68852219-1', 'auto');
  ga('send', 'pageview');
</script>

 

<meta name="author" content="Morgan" />
<meta name="description" content="Créer un formulaire sous django avec django-crispy-forms" />
<meta name="keywords" content="python, django, formulaire, bootstrap, crispy, forms, captcha, datetimepicker">


  <meta property="og:site_name" content=".mobo"/>
  <meta property="og:title" content="Créer un formulaire sous django avec django-crispy-forms"/>
  <meta property="og:description" content="Créer un formulaire sous django avec django-crispy-forms"/>
  <meta property="og:locale" content="fr_FR"/>
  <meta property="og:url" content="https://dotmobo.github.io/django-crispy-forms.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2016-05-04 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://dotmobo.github.io/author/morgan.html">
  <meta property="article:section" content="Django"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="django"/>
  <meta property="article:tag" content="formulaire"/>
  <meta property="article:tag" content="bootstrap"/>
  <meta property="article:tag" content="crispy"/>
  <meta property="article:tag" content="forms"/>
  <meta property="article:tag" content="captcha"/>
  <meta property="article:tag" content="datetimepicker"/>
  <meta property="og:image" content="//dotmobo.github.io/images/avatar700.jpg">

  <title>.mobo &ndash; Créer un formulaire sous django avec django-crispy-forms</title>


</head>
<body >

<aside>
  <div>
    <a href="https://dotmobo.github.io/">
      <img src="//dotmobo.github.io/images/avatar700.jpg" alt=".mobo" title=".mobo">
    </a>

    <h1>
      <a href="https://dotmobo.github.io/">.mobo</a>
    </h1>

    <p>Explorations d'un développeur</p>



    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/dotmobo"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/dotmobo"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="//dotmobo.github.io/feeds/all.atom.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
  </div>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-aside"
         data-ad-client="ca-pub-1630762128981156"
         data-ad-slot="6859931822"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</aside>
  <main>

<nav>
  <a href="https://dotmobo.github.io/">Accueil</a>

  <a href="/categories.html">Catégories</a>
  <a href="/tags.html">Tags</a>
  <a href="/archives.html">Archives</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="django-crispy-forms">Créer un formulaire sous django avec django-crispy-forms</h1>
    <p>
      Posté le 04/05/2016 dans <a href="https://dotmobo.github.io/category/django.html">Django</a>

    </p>
  </header>


  <div>
    <img alt="Django" class="align-right" src="./images/djangopony.png" />
<p><a class="reference external" href="http://django-crispy-forms.readthedocs.io/">Django-crispy-forms</a> est une application django
qui va te permettre de construire, customiser et réutiliser tes formulaires en utilisant ton
framework CSS favori. Il permet d'éviter d'écrire une tonne de code dans les templates et applique la
philosophie <a class="reference external" href="https://fr.wikipedia.org/wiki/Ne_vous_r%C3%A9p%C3%A9tez_pas">DRY</a>.</p>
<p>Par défaut, il supporte les frameworks CSS <a class="reference external" href="http://getbootstrap.com/">bootstrap</a>,
<a class="reference external" href="http://foundation.zurb.com/">foundation</a> et <a class="reference external" href="https://github.com/draganbabic/uni-form/">uni-form</a>.</p>
<p>On va voir comment tu peux créer un formulaire d'enregistrement compatible avec bootstrap en
utilisant des onglets, <a class="reference external" href="http://dotmobo.github.io/django-simple-captcha.html">un captcha</a>,
<a class="reference external" href="http://dotmobo.github.io/django-countries.html">une liste de pays</a> et
<a class="reference external" href="https://github.com/nkunihiko/django-bootstrap3-datetimepicker">un date picker</a>.</p>
<p>Pour simplifier ce tuto, on ne va pas s'occuper de l'internationalisation. Mais
rien ne t'empêches de la mettre en place de ton côté.</p>
<div class="section" id="l-installation-et-la-configuration">
<h2>1) L'installation et la configuration</h2>
<p>C'est parti ! On suppose que tu as déjà installé python 3.5 avec virtualenvwrapper.
Tu crées donc ton environnement virtuel et tu installes les librairies requises:</p>
<div class="highlight"><pre><span></span>mkvirtualenv<span class="w"> </span>-p<span class="w"> </span>/usr/bin/python3.5<span class="w"> </span>demo-django-crispy-forms
pip<span class="w"> </span>install<span class="w"> </span><span class="nv">Django</span><span class="o">==</span><span class="m">1</span>.9.6<span class="w"> </span>django-countries<span class="o">==</span><span class="m">3</span>.4.1<span class="w"> </span>django-crispy-forms<span class="o">==</span><span class="m">1</span>.6.0<span class="w"> </span><span class="se">\</span>
django-simple-captcha<span class="o">==</span><span class="m">0</span>.5.1
</pre></div>
<p>La version compatible de <em>django-bootstrap3-datetimepicker</em> avec django 1.9 n'est pas encore disponible
sur pypi. Du coup, tu l'installes directement depuis github:</p>
<div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/nkunihiko/django-bootstrap3-datetimepicker.git@2fa9ea5
</pre></div>
<p>Tu crées un projet django appelé <strong>demo-django-crispy-forms</strong>, qui contient une application <strong>core</strong>:</p>
<div class="highlight"><pre><span></span>django-admin<span class="w"> </span>startproject<span class="w"> </span>demo_django_crispy_forms
<span class="nb">cd</span><span class="w"> </span>demo_django_crispy_forms/demo_django_crispy_forms
mkdir<span class="w"> </span>apps<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>apps
django-admin<span class="w"> </span>startapp<span class="w"> </span>core
</pre></div>
<p>Dans le fichier <strong>settings.py</strong> de ton projet, tu modifies/ajoutes les lignes suivantes:</p>
<div class="highlight"><pre><span></span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;fr&#39;</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;Europe/Paris&#39;</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">&#39;crispy_forms&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django_countries&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bootstrap3_datetime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;captcha&#39;</span><span class="p">,</span>
    <span class="s1">&#39;demo_django_crispy_forms.apps.core&#39;</span>
<span class="p">)</span>
<span class="n">CRISPY_TEMPLATE_PACK</span> <span class="o">=</span> <span class="s1">&#39;bootstrap3&#39;</span>
</pre></div>
<p>Tu as ainsi défini la langue et le time zone, ajouté les applications installées précédemment
et utilisé le template <strong>bootstrap3</strong> pour <em>crispy-forms</em>.</p>
<p>Il te suffit de migrer la base de données et de vérifier que tout est bon pour l'instant.
Depuis le répertoire racine du projet, tu fais:</p>
<div class="highlight"><pre><span></span>./manage.py<span class="w"> </span>migrate<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./manage.py<span class="w"> </span>check
</pre></div>
</div>
<div class="section" id="le-modele">
<h2>2) Le modèle</h2>
<p>Maintenant que tu as fini l'installation et le paramétrage des différentes libraires,
tu vas pouvoir créer le modèle de ton inscription.</p>
<p>Dans <strong>apps/core/models.py</strong>, tu définis le modèle <strong>Registration</strong> suivant :</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django_countries.fields</span> <span class="kn">import</span> <span class="n">CountryField</span>


<span class="k">class</span> <span class="nc">Registration</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Modèle de l&#39;inscription</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CIVILITY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="s1">&#39;M.&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;MME&#39;</span><span class="p">,</span> <span class="s1">&#39;Mme&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">STREET_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;Boulevard&#39;</span><span class="p">,</span> <span class="s1">&#39;Boulevard&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Avenue&#39;</span><span class="p">,</span> <span class="s1">&#39;Avenue&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Cours&#39;</span><span class="p">,</span> <span class="s1">&#39;Cours&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Place&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Rue&#39;</span><span class="p">,</span> <span class="s1">&#39;Rue&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Route&#39;</span><span class="p">,</span> <span class="s1">&#39;Route&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Voie&#39;</span><span class="p">,</span> <span class="s1">&#39;Voie&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Chemin&#39;</span><span class="p">,</span> <span class="s1">&#39;Chemin&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Square&#39;</span><span class="p">,</span> <span class="s1">&#39;Square&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Impasse&#39;</span><span class="p">,</span> <span class="s1">&#39;Impasse&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Rond-point&#39;</span><span class="p">,</span> <span class="s1">&#39;Rond-point&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Quai&#39;</span><span class="p">,</span> <span class="s1">&#39;Quai&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">civility</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">CIVILITY_CHOICES</span><span class="p">,</span>
                                <span class="n">default</span><span class="o">=</span><span class="s1">&#39;M.&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Civilité&quot;</span><span class="p">)</span>
    <span class="n">birth_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Nom de naissance&quot;</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Nom d&#39;usage ou marital&quot;</span><span class="p">)</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Prénom&quot;</span><span class="p">)</span>
    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Date de naissance &quot;</span><span class="p">)</span>
    <span class="n">birth_place</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Ville de naissance&quot;</span><span class="p">)</span>
    <span class="n">birth_country</span> <span class="o">=</span> <span class="n">CountryField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Pays de naissance&quot;</span><span class="p">)</span>
    <span class="n">mail</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Mail&quot;</span><span class="p">)</span>
    <span class="n">street_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Type de rue&quot;</span><span class="p">,</span>
                                   <span class="n">choices</span><span class="o">=</span><span class="n">STREET_TYPE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Rue&#39;</span><span class="p">)</span>
    <span class="n">street_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Numéro de rue&quot;</span><span class="p">)</span>
    <span class="n">street</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Rue&quot;</span><span class="p">)</span>
    <span class="n">comp_1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Complément 1&quot;</span><span class="p">,</span>
                              <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">comp_2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Complément 2&quot;</span><span class="p">,</span>
                              <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Ville&quot;</span><span class="p">)</span>
    <span class="n">zip_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Code postal&quot;</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">CountryField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Pays&quot;</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Téléphone&quot;</span><span class="p">)</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;Commentaires&quot;</span><span class="p">)</span>
</pre></div>
<p>Pour chaque champ, <em>crispy-forms</em> va :</p>
<ul class="simple">
<li>utiliser le <strong>verbose_name</strong> comme label.</li>
<li>vérifier les paramètres <strong>blank</strong> et <strong>null</strong> pour savoir si le champ est obligatoire.</li>
<li>utiliser le type de champ pour définir le type de la balise <strong>&lt;input&gt;</strong>.</li>
<li>récupérer les valeurs du paramètre <strong>choices</strong> (si présent) pour la balise <strong>&lt;select&gt;</strong>.</li>
</ul>
<p>Enfin, tu mets à jour la base de données:</p>
<div class="highlight"><pre><span></span>./manage.py<span class="w"> </span>makemigrations
./manage.py<span class="w"> </span>migrate
</pre></div>
</div>
<div class="section" id="le-formulaire">
<h2>3) Le formulaire</h2>
<p>Place au formulaire. J'ai rajouté des commentaires directement dans le code
ci-dessous pour expliquer les différentes étapes.</p>
<p>Dans <strong>apps/core/forms.py</strong>, tu mets:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Registration</span>
<span class="kn">from</span> <span class="nn">crispy_forms.helper</span> <span class="kn">import</span> <span class="n">FormHelper</span>
<span class="kn">from</span> <span class="nn">crispy_forms.bootstrap</span> <span class="kn">import</span> <span class="n">StrictButton</span>
<span class="kn">from</span> <span class="nn">bootstrap3_datetime.widgets</span> <span class="kn">import</span> <span class="n">DateTimePicker</span>
<span class="kn">from</span> <span class="nn">crispy_forms.layout</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">crispy_forms.bootstrap</span> <span class="kn">import</span> <span class="n">TabHolder</span><span class="p">,</span> <span class="n">Tab</span>
<span class="kn">from</span> <span class="nn">captcha.fields</span> <span class="kn">import</span> <span class="n">CaptchaField</span>


<span class="k">class</span> <span class="nc">RegistrationForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formulaire d&#39;inscription</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ici, tu vas rajouter les champs supplémentaires au modèle</span>
    <span class="c1"># Tu définis le captcha</span>
    <span class="n">captcha</span> <span class="o">=</span> <span class="n">CaptchaField</span><span class="p">()</span>
    <span class="c1"># Tu ajoutes un mail de confirmation</span>
    <span class="n">confirmation_mail</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mail de confirmation&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Surcharge de l&#39;initialisation du formulaire</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Tu modifies le label de la date de naissance pour rajouter le format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (JJ/MM/AAAA)&quot;</span> <span class="o">%</span> <span class="s2">&quot;Date de naissance&quot;</span>
        <span class="c1"># Tu utilises FormHelper pour customiser ton formulaire</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">()</span>
        <span class="c1"># Tu définis l&#39;id et la classe bootstrap de ton formulaire</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_class</span> <span class="o">=</span> <span class="s1">&#39;form-horizontal&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">form_id</span> <span class="o">=</span> <span class="s1">&#39;registration-form&#39;</span>
        <span class="c1"># Tu définis la taille des labels et des champs sur la grille</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">label_class</span> <span class="o">=</span> <span class="s1">&#39;col-md-2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">field_class</span> <span class="o">=</span> <span class="s1">&#39;col-md-8&#39;</span>
        <span class="c1"># Tu crées l&#39;affichage de ton formulaire</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span>
            <span class="c1"># Le formulaire va contenir 3 onglets</span>
            <span class="n">TabHolder</span><span class="p">(</span>
                <span class="c1"># Premier onglet</span>
                <span class="n">Tab</span><span class="p">(</span>
                    <span class="c1"># Label de l&#39;onglet</span>
                    <span class="s1">&#39;Étape 1 - Identité&#39;</span><span class="p">,</span>
                    <span class="c1"># Liste des champs du modèle à afficher dans l&#39;onglet</span>
                    <span class="s1">&#39;civility&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;birth_name&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;last_name&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;first_name&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;birth_date&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;birth_place&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;birth_country&#39;</span><span class="p">,</span>
                    <span class="c1"># Tu rajoutes un bouton &quot;Suivant&quot;</span>
                    <span class="n">StrictButton</span><span class="p">(</span>
                        <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-arrow-right&quot; </span><span class="se">\</span>
<span class="s1">                        aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;Suivant&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
                        <span class="n">css_class</span><span class="o">=</span><span class="s1">&#39;btn-default col-md-offset-9 btnNext&#39;</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="p">),</span>
                <span class="c1"># Deuxième onglet</span>
                <span class="n">Tab</span><span class="p">(</span>
                    <span class="c1"># Label de l&#39;onglet</span>
                    <span class="s1">&#39;Étape 2 - Adresse&#39;</span><span class="p">,</span>
                    <span class="c1"># Liste des champs à afficher</span>
                    <span class="s1">&#39;street_number&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;street_type&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;street&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;comp_1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;comp_2&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;city&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;zip_code&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;country&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;phone&#39;</span><span class="p">,</span>
                    <span class="c1"># Tu rajoutes des boutons &quot;Précédent&quot; et &quot;Suivant&quot;</span>
                    <span class="n">StrictButton</span><span class="p">(</span>
                        <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-arrow-left&quot; </span><span class="se">\</span>
<span class="s1">                        aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Précédent&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
                        <span class="n">css_class</span><span class="o">=</span><span class="s1">&#39;btn-default btnPrevious&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">StrictButton</span><span class="p">(</span>
                        <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-arrow-right&quot; </span><span class="se">\</span>
<span class="s1">                        aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;Suivant&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
                        <span class="n">css_class</span><span class="o">=</span><span class="s1">&#39;btn-default col-md-offset-8 btnNext&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="c1"># Troisième onglet</span>
                <span class="n">Tab</span><span class="p">(</span>
                    <span class="c1"># Label de l&#39;onglet</span>
                    <span class="s1">&#39;Étape 3 - Validation&#39;</span><span class="p">,</span>
                    <span class="c1"># Liste des champs à afficher dont les champs supplémentaires</span>
                    <span class="s1">&#39;mail&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;confirmation_mail&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;captcha&#39;</span><span class="p">,</span>
                    <span class="c1"># Tu rajoutes des boutons &quot;Précédent&quot; et &quot;Valider&quot;</span>
                    <span class="n">StrictButton</span><span class="p">(</span>
                        <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-arrow-left&quot; </span><span class="se">\</span>
<span class="s1">                        aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;Précédent&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
                        <span class="n">css_class</span><span class="o">=</span><span class="s1">&#39;btn-default btnPrevious&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">StrictButton</span><span class="p">(</span>
                        <span class="s1">&#39;&lt;span class=&quot;glyphicon glyphicon-ok&quot; </span><span class="se">\</span>
<span class="s1">                        aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;Valider&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span>
                        <span class="n">css_class</span><span class="o">=</span><span class="s1">&#39;btn-default col-md-offset-8&#39;</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_confirmation_mail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode pour vérifier que le mail correspond bien au</span>
<span class="sd">        mail de confirmation lors de la validation du formulaire</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confirmation_mail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;confirmation_mail&#39;</span><span class="p">]</span>
        <span class="n">mail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;mail&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mail</span> <span class="o">!=</span> <span class="n">confirmation_mail</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Le mail et le mail de confirmation ne sont pas identiques&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">confirmation_mail</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c1"># Tu définis le modèle utilisé</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Registration</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Tu customises le champ date de naissance pour ajouter le date picker</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;birth_date&#39;</span><span class="p">:</span> <span class="n">DateTimePicker</span><span class="p">(</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;DD/MM/YYYY&quot;</span><span class="p">,</span> <span class="s2">&quot;pickTime&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="s2">&quot;useStrict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;viewMode&quot;</span><span class="p">:</span> <span class="s2">&quot;years&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;startDate&quot;</span><span class="p">:</span> <span class="s2">&quot;01/01/1900&quot;</span><span class="p">},</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;ex: 05/11/1975&#39;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="les-vues">
<h2>4) Les vues</h2>
<p>Maintenant que tu as ton formulaire, il te faut une vue pour afficher le formulaire
et une autre pour afficher un message de confirmation après la validation de celui-ci.</p>
<p>Tu vas créer tout ça dans <strong>apps/core/views.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic.edit</span> <span class="kn">import</span> <span class="n">CreateView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Registration</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">RegistrationForm</span>


<span class="k">class</span> <span class="nc">RegistrationCreate</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Affichage du formulaire</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Registration</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">RegistrationForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;core:success&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">registration_success</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Message de confirmation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;core/registration_success.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="les-urls">
<h2>5) Les urls</h2>
<p>Dans le fichier des urls du projet, tu vas inclure les urls de l'application <strong>core</strong>
et l'url pour le captcha.</p>
<p>Dans <strong>urls.py</strong>, tu insères:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.apps.core.urls</span> <span class="kn">import</span> <span class="n">urlpatterns</span> <span class="k">as</span> <span class="n">core_urls</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">core_urls</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;core&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^captcha/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;captcha.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
<p>Et dans <strong>apps/core/urls.py</strong>, tu mets les urls correspondantes à tes deux vues:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">RegistrationCreate</span><span class="p">,</span> <span class="n">registration_success</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">RegistrationCreate</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^success/$&#39;</span><span class="p">,</span> <span class="n">registration_success</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;success&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="les-templates">
<h2>6) Les templates</h2>
<p>Tu vas créer trois templates:</p>
<ul class="simple">
<li>Le premier, <strong>base.html</strong>, qui servira de base aux deux autres.</li>
<li>Le deuxième, <strong>core/registration_form.html</strong>, pour afficher le formulaire.</li>
<li>Le dernier, <strong>core/registration_success.html</strong>, pour afficher le message de confirmation.</li>
</ul>
<p>Le template <strong>apps/core/templates/base.html</strong> va contenir:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;fr&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mon site<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
          <span class="na">href</span><span class="o">=</span><span class="s">&quot;//cdn.jsdelivr.net/bootstrap/3.3.6/css/bootstrap.min.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span>
          <span class="na">href</span><span class="o">=</span><span class="s">&quot;//cdn.jsdelivr.net/bootstrap/3.3.6/css/bootstrap-theme.min.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//cdn.jsdelivr.net/jquery/2.2.3/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% block head-javascript %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;summary&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;page-header&quot;</span><span class="p">&gt;</span>
            {% block page-header %}{% endblock %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% block content %}
    {% endblock %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//cdn.jsdelivr.net/bootstrap/3.3.6/js/bootstrap.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% block foot-javascript %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>C'est une page html5 standard, qui contient les fichiers nécessaires à bootstrap,
un <strong>block page-header</strong> pour afficher le titre de la page et un <strong>block content</strong>
pour afficher le contenu de la page. Les templates suivants vont donc étendre <strong>base.html</strong>.</p>
<p>Pour le template <strong>apps/core/templates/core/registration_form.html</strong>, tu mets:</p>
<div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}
{% load crispy_forms_tags %}

{% block head-javascript %}
    {{ form.media }}
{% endblock %}

{% block page-header %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Inscription<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% endblock %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>{% crispy form %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}

{% block foot-javascript %}
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="w"> </span><span class="nb">document</span><span class="w"> </span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// On interdit le copier/coller du mail</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_confirmation_mail&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;copy paste&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On affiche le calendrier lorsqu&#39;on clique sur le champ date de naissance</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_birth_date&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;DateTimePicker&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On teste la valeur de la date et on la force à vide si elle est mauvaise</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#id_birth_date&#39;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\d{2}\/\\d{2}\/\\d{4}$&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">format</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Afficher l&#39;onglet suivant en cliquant sur le bouton suivant</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.btnNext&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.nav-tabs &gt; .active + li a&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.nav-tabs + .tab-content&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:input:visible:first&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Afficher l&#39;onglet précédent en cliquant sur le bouton précédent</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.btnPrevious&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.nav-tabs &gt; .active&#39;</span><span class="p">).</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.nav-tabs + .tab-content&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;:input:visible:first&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
<p>Pour <em>crispy-forms</em>, il ne faut que deux éléments ! Le <strong>{% load crispy_forms_tags %}</strong>,
qui permet d'utiliser le <strong>{% crispy form %}</strong> pour afficher le formulaire.</p>
<p>Et c'est tout ! Plutôt cool non ?</p>
<p>Le <strong>{{ form.media }}</strong> est nécessaire au date picker et tout ce qui se trouve dans
le <strong>block foot-javascript</strong> permet de pousser un peu plus la customisation.</p>
<p>Enfin, de la même manière, tu crées le template <strong>apps/core/templates/core/registration_success.html</strong>:</p>
<div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}

{% block page-header %}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Succès<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% endblock %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>Votre inscription a été validée.<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<div class="section" id="la-page-d-administration">
<h2>7) La page d'administration</h2>
<p>Pour pouvoir vérifier les futures inscriptions, tu ajoutes le modèle <strong>Registration</strong> dans <strong>apps/core/admin.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Registration</span>


<span class="k">class</span> <span class="nc">RegistrationAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;birth_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">)</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Registration</span><span class="p">,</span> <span class="n">RegistrationAdmin</span><span class="p">)</span>
</pre></div>
<p>Tu vas également en profiter pour ajouter un compte admin via:</p>
<div class="highlight"><pre><span></span>./manage.py<span class="w"> </span>createsuperuser
</pre></div>
</div>
<div class="section" id="la-verification">
<h2>8) La vérification</h2>
<p>Tout est fini ! Il ne reste plus qu'à vérifier que ça fonctionne correctement.</p>
<p>Tu démarres le serveur:</p>
<div class="highlight"><pre><span></span>./manage.py<span class="w"> </span>runserver
</pre></div>
<p>Puis, tu te rends sur <a class="reference external" href="http://127.0.0.1:8000">http://127.0.0.1:8000</a>
pour tester ton formulaire !</p>
<img alt="Crispy" class="align-left" src="./images/crispy1.png" />
<p>Après avoir correctement saisie et validé le formulaire, rends-toi sur
<a class="reference external" href="http://127.0.0.1:8000/admin/core/registration/">http://127.0.0.1:8000/admin/core/registration/</a>
pour vérifier ton inscription.</p>
<p>Tu sais désormais utiliser un outil puissant pour générer tes nombreux formulaires !
Et pour voir le résultat final, tu peux te rendre sur
<a class="reference external" href="https://github.com/dotmobo/demo-django-crispy-forms">mon dépôt github</a>.</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://dotmobo.github.io/tag/python.html">python</a>
      <a href="https://dotmobo.github.io/tag/django.html">django</a>
      <a href="https://dotmobo.github.io/tag/formulaire.html">formulaire</a>
      <a href="https://dotmobo.github.io/tag/bootstrap.html">bootstrap</a>
      <a href="https://dotmobo.github.io/tag/crispy.html">crispy</a>
      <a href="https://dotmobo.github.io/tag/forms.html">forms</a>
      <a href="https://dotmobo.github.io/tag/captcha.html">captcha</a>
      <a href="https://dotmobo.github.io/tag/datetimepicker.html">datetimepicker</a>
    </p>
  </div>






<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dotmobo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Veuillez activer le JavaScript pour voir les commentaires.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>
  &copy; 2018  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Construit avec <a href="http://getpelican.com" target="_blank">Pelican</a> utilisant le thème <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a>
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://dotmobo.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " .mobo ",
  "url" : "https://dotmobo.github.io",
  "image": "//dotmobo.github.io/images/avatar700.jpg",
  "description": ".mobo - explorations d'un développeur"
}
</script>
</body>
</html>