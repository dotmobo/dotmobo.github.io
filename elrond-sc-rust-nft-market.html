
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://dotmobo.xyz/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://dotmobo.xyz/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://dotmobo.xyz/theme/pygments/emacs.min.css">



  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/css/custom.css">


  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">



<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68852219-1', 'auto');
  ga('send', 'pageview');
</script>

 

<meta name="author" content="Morgan" />
<meta name="description" content="Smart Contract Elrond en Rust : NFT market" />
<meta name="keywords" content="elrond, rust, nft, market">


  <meta property="og:site_name" content=".mobo"/>
  <meta property="og:title" content="Smart Contract Elrond en Rust : NFT market"/>
  <meta property="og:description" content="Smart Contract Elrond en Rust : NFT market"/>
  <meta property="og:locale" content="fr_FR"/>
  <meta property="og:url" content="https://dotmobo.xyz/elrond-sc-rust-nft-market.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2022-07-07 00:00:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://dotmobo.xyz/author/morgan.html">
  <meta property="article:section" content="Rust"/>
  <meta property="article:tag" content="elrond"/>
  <meta property="article:tag" content="rust"/>
  <meta property="article:tag" content="nft"/>
  <meta property="article:tag" content="market"/>
  <meta property="og:image" content="//dotmobo.github.io/images/avatar700.jpg">

  <title>.mobo &ndash; Smart Contract Elrond en Rust : NFT market</title>


</head>
<body >

<aside>
  <div>
    <a href="https://dotmobo.xyz/">
      <img src="//dotmobo.github.io/images/avatar700.jpg" alt=".mobo" title=".mobo">
    </a>

    <h1>
      <a href="https://dotmobo.xyz/">.mobo</a>
    </h1>

    <p>Explorations d'un développeur</p>



    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/dotmobo"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/dotmobo"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="//dotmobo.github.io/feeds/all.atom.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
  </div>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle ads-aside"
         data-ad-client="ca-pub-1630762128981156"
         data-ad-slot="6859931822"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</aside>
  <main>

<nav>
  <a href="https://dotmobo.xyz/">Accueil</a>

  <a href="/categories.html">Catégories</a>
  <a href="/tags.html">Tags</a>
  <a href="/archives.html">Archives</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="elrond-sc-rust-nft-market">Smart Contract Elrond en Rust : NFT market</h1>
    <p>
      Posté le 07/07/2022 dans <a href="https://dotmobo.xyz/category/rust.html">Rust</a>

    </p>
  </header>


  <div>
    <img alt="Elrond" class="align-right" src="./images/elrond.png" />
<p>C'est parti pour le troisième épisode de la série sur les Smart Contracts <a class="reference external" href="https://elrond.com/">Elrond</a>
en <a class="reference external" href="https://rust-lang.org/">Rust</a>. Après avoir vu comment <a class="reference external" href="http://dotmobo.github.io/elrond-sc-rust-nft-staking.html#elrond-sc-rust-nft-staking">staker un NFT</a> pour gagner des $DEAD et comment
utiliser ces $DEAD pour <a class="reference external" href="http://dotmobo.github.io/elrond-sc-rust-dao-vote.html#elrond-sc-rust-dao-vote">voter dans notre DAO</a>, on va pouvoir désormais acheter des NFTs sur notre propre
<em>marketplace</em> avec des $DEAD.</p>
<div class="section" id="contexte">
<h2>Contexte</h2>
<p>On doit pouvoir envoyer des NFTs sur un Smart Contract pour ainsi les vendre avec notre propre ESDT,
ici $DEAD.</p>
<p>C'est une version très simplifié d'un <em>marketplace</em> dans le sens où :</p>
<ul class="simple">
<li>on ne va pouvoir vendre les NFTs que d'une seule collection à la fois.</li>
<li>le prix de chaque NFT sera identique.</li>
</ul>
<p>Si on veut avoir des prix différents ou utiliser une autre collection, il faudra soit changer les paramètres
du Smart Contract, soit déployer un autre Smart Contract.</p>
<p>Dans ta <strong>dapp</strong>, ça pourra donner quelque-chose comme ça :</p>
<img alt="Elrond" src="./images/market.jpg" />
</div>
<div class="section" id="smart-contract">
<h2>Smart Contract</h2>
<p>Comme d'habitude, on crée un SC vide à l'aide de <strong>erdpy</strong>.</p>
<div class="highlight"><pre><span></span>erdpy<span class="w"> </span>contract<span class="w"> </span>new<span class="w"> </span>market<span class="w"> </span>--template<span class="w"> </span>empty
</pre></div>
<p>Et on passe directement à l'écriture du SC dans <strong>src/empty.rs</strong>. Notre fonction d'initialisation
va prendre en paramètre l'identifiant du token à utiliser pour les paiements, le prix d'un NFT ainsi
que l'identifiant de la collection de NFT que l'on souhaite vendre.</p>
<div class="highlight"><pre><span></span><span class="cp">#![no_std]</span>

<span class="n">elrond_wasm</span><span class="p">::</span><span class="n">imports</span><span class="o">!</span><span class="p">();</span>

<span class="sd">/// An empty contract. To be used as a template when starting a new contract from scratch.</span>
<span class="cp">#[elrond_wasm::contract]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">EmptyContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cp">#[init]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">token_id</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenIdentifier</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">:</span><span class="w"> </span><span class="nc">BigUint</span><span class="p">,</span><span class="w"> </span><span class="n">nft_identifier</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenIdentifier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">token_id</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">token_id</span><span class="p">);</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">price</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">price</span><span class="p">);</span>
<span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">nft_identifier</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nft_identifier</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">BigUint</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">0</span><span class="k">u32</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>On ajoute dans notre <strong>trait</strong> les <strong>storage_mapper</strong> et <strong>view</strong> des différentes variables que l'on va stocker dans le SC.
L'élément <strong>bank</strong> correspond au montant total de $DEAD que l'on a dans notre SC suite aux divers paiements réalisés.</p>
<div class="highlight"><pre><span></span><span class="cp">#[view(getBank)]</span>
<span class="cp">#[storage_mapper(</span><span class="s">&quot;bank&quot;</span><span class="cp">)]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">bank</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SingleValueMapper</span><span class="o">&lt;</span><span class="n">BigUint</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cp">#[view(getTokenId)]</span>
<span class="cp">#[storage_mapper(</span><span class="s">&quot;token_id&quot;</span><span class="cp">)]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">token_id</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SingleValueMapper</span><span class="o">&lt;</span><span class="n">TokenIdentifier</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cp">#[view(getNftIdentifier)]</span>
<span class="cp">#[storage_mapper(</span><span class="s">&quot;nft_identifier&quot;</span><span class="cp">)]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">nft_identifier</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SingleValueMapper</span><span class="o">&lt;</span><span class="n">TokenIdentifier</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cp">#[view(getPrice)]</span>
<span class="cp">#[storage_mapper(</span><span class="s">&quot;price&quot;</span><span class="cp">)]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">price</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SingleValueMapper</span><span class="o">&lt;</span><span class="n">BigUint</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
<p>Ensuite, on ajoute quelques petites fonctions utilitaires pour l'administrateur du SC.
On lui donne la possibilité de récupérer tous les fonds de la banque, de changer le prix de vente des NFTs
ou de changer l'identifiant de la collection de NFT que l'on souhaite vendre. Attention à ne pas oublier le
<strong>only_owner</strong>, sinon n'importe qui pourrait appeler ces fonctions !</p>
<div class="highlight"><pre><span></span><span class="cp">#[only_owner]</span>
<span class="cp">#[endpoint]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">withdraw</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SCResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">blockchain</span><span class="p">().</span><span class="n">get_caller</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">token_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">token_id</span><span class="p">().</span><span class="n">get</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">get</span><span class="p">();</span>

<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">send</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">direct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caller</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">token_id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bank</span><span class="p">,</span><span class="w"> </span><span class="s">b&quot;withdraw successful&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// reset the bank</span>
<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="n">BigUint</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">0</span><span class="k">u32</span><span class="p">));</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>

<span class="cp">#[only_owner]</span>
<span class="cp">#[endpoint]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">change_price</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">:</span><span class="w"> </span><span class="nc">BigUint</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SCResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">price</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">price</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>

<span class="cp">#[only_owner]</span>
<span class="cp">#[endpoint]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">change_nft_identifier</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">nft_identifier</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenIdentifier</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SCResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">nft_identifier</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nft_identifier</span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></div>
<p>Enfin, on a la fonction principale de notre SC qui permet d'acheter des NFTs.
On vérifie ici le type du token, le montant envoyé et l'identifiant de la collection de NFT.
Le <strong>nonce</strong> envoyé en paramètre correspond au numéro du NFT que l'utilisateur veut acheter.
Si tout est bon, on lui envoie le NFT via la fonction <strong>self.send().direct()</strong> et on incrémente la banque.</p>
<div class="highlight"><pre><span></span><span class="cp">#[payable(</span><span class="s">&quot;*&quot;</span><span class="cp">)]</span>
<span class="cp">#[endpoint]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">buy</span><span class="p">(</span>
<span class="w">    </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span>
<span class="w">    </span><span class="cp">#[payment_token]</span><span class="w"> </span><span class="n">payment_token</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenIdentifier</span><span class="p">,</span>
<span class="w">    </span><span class="cp">#[payment_amount]</span><span class="w"> </span><span class="n">payment_amount</span><span class="p">:</span><span class="w"> </span><span class="nc">BigUint</span><span class="p">,</span>
<span class="w">    </span><span class="n">nft_identifier</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenIdentifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">nft_nonce</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">SCResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span>
<span class="w">        </span><span class="n">payment_token</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">token_id</span><span class="p">().</span><span class="n">get</span><span class="p">(),</span>
<span class="w">        </span><span class="s">&quot;Invalid payment token&quot;</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span>
<span class="w">        </span><span class="n">payment_amount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">price</span><span class="p">().</span><span class="n">get</span><span class="p">(),</span>
<span class="w">        </span><span class="s">&quot;Invalid payment amount&quot;</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span>
<span class="w">        </span><span class="n">nft_identifier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">nft_identifier</span><span class="p">().</span><span class="n">get</span><span class="p">(),</span>
<span class="w">        </span><span class="s">&quot;Invalid nft identifier&quot;</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">blockchain</span><span class="p">().</span><span class="n">get_caller</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigUint</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="mi">1</span><span class="k">u32</span><span class="p">);</span>
<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">send</span><span class="p">().</span><span class="n">direct</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caller</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nft_identifier</span><span class="p">,</span><span class="w"> </span><span class="n">nft_nonce</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amount</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">b&quot;purchase successful&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Add the amount to the bank</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">get</span><span class="p">();</span>
<span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">bank</span><span class="p">().</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bank</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">payment_amount</span><span class="p">);</span>


<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></div>
<p>Tu compiles ton SC avec <strong>erdpy</strong> pour vérifier que tout est ok :</p>
<div class="highlight"><pre><span></span>erdpy<span class="w"> </span>contract<span class="w"> </span>build
</pre></div>
<p>Tu peux trouver le résultat final <a class="reference external" href="https://github.com/dotmobo/dbc-dashboard/blob/master/contract/buy_serum/src/empty.rs">ici</a>.</p>
</div>
<div class="section" id="deploiement">
<h2>Déploiement</h2>
<p>Comme dans les précédents épisodes, tu configures ton fichier <strong>erdpy.json</strong> pour déployer le SC
sur devnet en lui passant les bons arguments. Le SC doit être payable via <strong>&quot;metadata-payable&quot;: true</strong> et
le <strong>pem</strong> de ton <strong>wallet</strong> doit se trouver sur <strong>../../wallet/wallet-owner.pem</strong>.</p>
<p>Concernant les arguments, <strong>DEADBROS-fa8f0f</strong> correspond à l'identifiant du token, <strong>100000000000000000000</strong>
au prix d'un NFT avec 18 decimals et <strong>DEAD1-2d86a5</strong> est l'id de la collection de NFT à vendre.</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;proxy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://devnet-api.elrond.com&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;chainID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;D&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;contract&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;deploy&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;verbose&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;bytecode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;output/buy_serum.wasm&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;recall-nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;metadata-payable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;pem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;../../wallet/wallet-owner.pem&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;gas-limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">59999999</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;str:DEADBROS-fa8f0f&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;100000000000000000000&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;str:DEAD1-2d86a5&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;send&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;outfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deploy-testnet.interaction.json&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;upgrade&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;verbose&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;bytecode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;output/buy_serum.wasm&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;recall-nonce&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;metadata-payable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;pem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;../../wallet/wallet-owner.pem&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;gas-limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">59999999</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;str:DEADBROS-fa8f0f&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;100000000000000000000&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;str:DEAD1-2d86a5&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;send&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;outfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deploy-testnet.interaction.json&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Tu peux alors déployer ton SC et tester les transactions avec <strong>erdpy</strong>.</p>
<div class="highlight"><pre><span></span>erdpy<span class="w"> </span>contract<span class="w"> </span>deploy
erdpy<span class="w"> </span>tx<span class="w"> </span>new<span class="w"> </span>--help
</pre></div>
<p>N'oublie pas d'envoyer les NFTs que tu souhaites vendre à l'adresse de ton SC !</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://dotmobo.xyz/tag/elrond.html">elrond</a>
      <a href="https://dotmobo.xyz/tag/rust.html">rust</a>
      <a href="https://dotmobo.xyz/tag/nft.html">nft</a>
      <a href="https://dotmobo.xyz/tag/market.html">market</a>
    </p>
  </div>






<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dotmobo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Veuillez activer le JavaScript pour voir les commentaires.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>
  &copy; 2018  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Construit avec <a href="http://getpelican.com" target="_blank">Pelican</a> utilisant le thème <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a>
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://dotmobo.xyz/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " .mobo ",
  "url" : "https://dotmobo.xyz",
  "image": "//dotmobo.github.io/images/avatar700.jpg",
  "description": ".mobo - explorations d'un développeur, partage de projets, tutoriels et réflexions sur le développement."
}
</script>
</body>
</html>