
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://dotmobo.github.io/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://dotmobo.github.io/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://dotmobo.github.io/theme/pygments/emacs.min.css">


  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.github.io/theme/font-awesome/css/solid.css">

    <link href="https://dotmobo.github.io/css/custom.css" rel="stylesheet">




<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68852219-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Morgan" />
<meta name="description" content="Mon environnement python en 2022" />
<meta name="keywords" content="python, librairies, poetry, black, isort, pyenv, mypy">


<meta property="og:site_name" content=".mobo"/>
<meta property="og:title" content="Mon environnement python en 2022"/>
<meta property="og:description" content="Mon environnement python en 2022"/>
<meta property="og:locale" content="fr_FR"/>
<meta property="og:url" content="https://dotmobo.github.io/environnement-python-2022.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2022-01-28 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://dotmobo.github.io/author/morgan.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="librairies"/>
<meta property="article:tag" content="poetry"/>
<meta property="article:tag" content="black"/>
<meta property="article:tag" content="isort"/>
<meta property="article:tag" content="pyenv"/>
<meta property="article:tag" content="mypy"/>
<meta property="og:image" content="//dotmobo.github.io/images/avatar700.jpg">

  <title>.mobo &ndash; Mon environnement python en 2022</title>

</head>
<body >
  <aside>
    <div>
      <a href="https://dotmobo.github.io">
        <img src="//dotmobo.github.io/images/avatar700.jpg" alt=".mobo" title=".mobo">
      </a>

      <h1>
        <a href="https://dotmobo.github.io">.mobo</a>
      </h1>

<p>Explorations d'un développeur</p>


      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/dotmobo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/dotmobo" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="//dotmobo.github.io/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://dotmobo.github.io">Accueil</a>

      <a href="/categories.html">Catégories</a>
      <a href="/tags.html">Tags</a>
      <a href="/archives.html">Archives</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="environnement-python-2022">Mon environnement python en 2022</h1>
    <p>
      Posté le 28/01/2022 dans <a href="https://dotmobo.github.io/category/python.html">Python</a>

    </p>
  </header>


  <div>
    <img alt="Python" class="align-right" src="./images/python.png" />
<p>Pour cette nouvelle année 2022, on va voir ensemble les quelques librairies plutôt cools pour
se faire un environnement de dev sympa et efficace en python ! On teste avec <strong>python 3.9</strong> car il y a encore des soucis de compatibilité
pour certaines librairies avec python 3.10.</p>
<div class="section" id="versions-de-python">
<h2>Versions de python</h2>
<p>Pour gérer les différentes versions de python sur ta machine, il est plutôt pratique d'utiliser <a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>.
Pour les devs JS, c'est un équivalent à <a class="reference external" href="https://github.com/nvm-sh/nvm">nvm</a> et à <a class="reference external" href="https://github.com/tj/n">n</a> mais pour python.</p>
<p>Pour l'installer et l'utiliser rien de plus simple :</p>
<div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>aria2<span class="w"> </span>build-essential<span class="w"> </span>curl<span class="w"> </span>git<span class="w"> </span>libbz2-dev<span class="w"> </span>libffi-dev<span class="w"> </span>liblzma-dev<span class="w"> </span><span class="se">\</span>
libncurses5-dev<span class="w"> </span>libncursesw5-dev<span class="w"> </span>libreadline-dev<span class="w"> </span>libsqlite3-dev<span class="w"> </span>libssl-dev<span class="w"> </span>llvm<span class="w"> </span>make<span class="w"> </span>tk-dev<span class="w"> </span>wget<span class="w"> </span>xz-utils<span class="w"> </span>zlib1g-dev
curl<span class="w"> </span>-L<span class="w"> </span>https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash

<span class="nb">export</span><span class="w"> </span><span class="nv">PYENV_ROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.pyenv&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PYENV_ROOT</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>pyenv<span class="w"> </span>init<span class="w"> </span>-<span class="k">)</span><span class="s2">&quot;</span>

pyenv<span class="w"> </span>install<span class="w"> </span><span class="m">3</span>.9.10
</pre></div>
<p>Après, si tu n'as pas besoin de gérer plein de versions différentes régulièrement, tu peux te cantonner à utiliser les packages de ta distro.</p>
</div>
<div class="section" id="environnement-virtuel-et-packaging">
<h2>Environnement virtuel et packaging</h2>
<p>Pour ma part, fini les <a class="reference external" href="https://github.com/pypa/virtualenv">virtualenv</a>, <a class="reference external" href="https://virtualenvwrapper.readthedocs.io/en/latest/">virtualenvwrapper</a>
et <a class="reference external" href="https://docs.python.org/fr/3/distutils/setupscript.html">setup.py</a>, et place
à <a class="reference external" href="https://python-poetry.org/">poetry</a> et au fichier <a class="reference external" href="https://python-poetry.org/docs/pyproject/">pyproject.toml</a> !</p>
<p>La communauté python peine depuis un moment à avoir de bons outils pour gérer le packaging des applications et <strong>poetry</strong> vient apporter une solution à
tout ça. Certains diront que sa non-compatibilité avec les fichiers <strong>setup.py</strong> est le mal absolu car non-standard, ce qui n'est pas complètement faux ...
Mais cet outil est tellement pratique que j'en ai fait fi.</p>
<p>On l'installe et on initie un nouveau projet avec un <strong>venv</strong> encapsulé automatiquement :</p>
<div class="highlight"><pre><span></span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>-

poetry<span class="w"> </span>new<span class="w"> </span>--src<span class="w"> </span>myapp
<span class="nb">cd</span><span class="w"> </span>myapp
poetry<span class="w"> </span>add<span class="w"> </span>black<span class="w"> </span>isort
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;print(&quot;Hello World!&quot;)&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>src/main.py
poetry<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>src/main.py
poetry<span class="w"> </span>build
poetry<span class="w"> </span>publish
</pre></div>
<p>Ici on a ajouté les librairies black et isort dans les dépendances du projet et on a exécuté notre script python &quot;Hello World!&quot;.
Ensuite, on a buildé un <strong>sdist</strong> et un <strong>wheel</strong> qu'on a déployé sur PyPI.</p>
<p>Et voici aperçu du fameux fichier <strong>pyproject.toml</strong> généré :</p>
<div class="highlight"><pre><span></span><span class="o">[</span>tool.poetry<span class="o">]</span>
<span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;myapp&quot;</span>
<span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>
<span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nv">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;mobo&quot;</span><span class="o">]</span>

<span class="o">[</span>tool.poetry.dependencies<span class="o">]</span>
<span class="nv">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^3.9&quot;</span>
<span class="nv">black</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^21.12b0&quot;</span>
<span class="nv">isort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^5.10.1&quot;</span>

<span class="o">[</span>tool.poetry.dev-dependencies<span class="o">]</span>
<span class="nv">pytest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^5.2&quot;</span>

<span class="o">[</span>build-system<span class="o">]</span>
<span class="nv">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;poetry-core&gt;=1.0.0&quot;</span><span class="o">]</span>
build-backend<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;poetry.core.masonry.api&quot;</span>
</pre></div>
<p>Quel gain de temps énorme !</p>
</div>
<div class="section" id="formattage-du-code">
<h2>Formattage du code</h2>
<p><a class="reference external" href="https://github.com/psf/black">Black</a> domine désormais de très loin tous les linters et autres formatteurs de code python. Plus besoin de
cumuler et de configurer une tonne d'outils comme pep8, flake8, pylint, pyflakes, pychecker.
On dégage tout ça et on utilise que <strong>black</strong>. Il va se charger de formatter correctement ton code, point barre. C'est l'équivalent du gofmt de golang.</p>
<p>Est-ce que le rendu est parfait ? Non. Est-ce qu'il est suffisamment bon pour qu'on arrête de se poser la question de comment formater notre code ?
Oui, mille fois oui.</p>
<p>On l'installe et on l'exécute sur notre projet et c'est tout. Pour automatiser tout ça, tu peux même le mettre sur un git hook, au commit par exemple.</p>
<div class="highlight"><pre><span></span>poetry<span class="w"> </span>add<span class="w"> </span>black
poetry<span class="w"> </span>run<span class="w"> </span>black<span class="w"> </span>src/
</pre></div>
<p>Si tu es quelqu'un de tatillon qui aime avoir ses importations bien ordonnées, tu peux utiliser <a class="reference external" href="https://github.com/PyCQA/isort">isort</a>.
Comme pour black, tu l'installes et tu le lances sur ton projet et c'est réglé :</p>
<div class="highlight"><pre><span></span>poetry<span class="w"> </span>add<span class="w"> </span>isort
poetry<span class="w"> </span>run<span class="w"> </span>isort<span class="w"> </span>src/
</pre></div>
</div>
<div class="section" id="typage-statique">
<h2>Typage statique</h2>
<p>Suite au succès de <a class="reference external" href="https://www.typescriptlang.org/">typescript</a> pour le typage statique de javascript, une sorte d'équivalent a vu le
jour pour python sous la forme d'une librairie optionnelle appelée <a class="reference external" href="https://github.com/python/mypy">mypy</a>.
Cette librarie permet d'annoter notre code pour expliciter les types de nos arguments, fonctions, classes, etc ...</p>
<p>Tu peux écrire ce script par exemple :</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, you are </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2"> years old.&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Jean&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</pre></div>
<p>Et tu verifies le typage à l'aide de la commande suivante :</p>
<div class="highlight"><pre><span></span>poetry<span class="w"> </span>add<span class="w"> </span>mypy
poetry<span class="w"> </span>run<span class="w"> </span>mypy<span class="w"> </span>src/
</pre></div>
</div>
<div class="section" id="tests-unitaires">
<h2>Tests unitaires</h2>
<p>Rien de neuf sous le soleil, on utilise toujours <a class="reference external" href="https://docs.pytest.org/en/6.2.x/">pytest</a> qui est installé par defaut avec poetry :</p>
<div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pytest
</pre></div>
<p>Il est même possible d'utiliser <a class="reference external" href="https://python-poetry.org/docs/faq/#is-tox-supported">tox avec poetry</a> pour exécuter les tests sous
plusieurs environnements avec un <strong>tox.ini</strong> ressemblant à ça :</p>
<div class="highlight"><pre><span></span><span class="o">[</span>tox<span class="o">]</span>
<span class="nv">isolated_build</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="nv">envlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>py27,<span class="w"> </span>py36

<span class="o">[</span>testenv<span class="o">]</span>
<span class="nv">whitelist_externals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>poetry
<span class="nv">commands</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span>poetry<span class="w"> </span>install<span class="w"> </span>-v
<span class="w">    </span>poetry<span class="w"> </span>run<span class="w"> </span>pytest<span class="w"> </span>tests/
</pre></div>
</div>
<div class="section" id="developpement-web">
<h2>Développement web</h2>
<p>Rien de révolutionnaire ici non plus. Dans 80% des cas, pour les applications moyennes et complexes, <a class="reference external" href="https://www.django-rest-framework.org/">django-rest-framework</a>
couplé au framework front-end de ton choix fera le café.</p>
<p>Pour les 20% de cas d'applications très simples, je reste sur le framework <a class="reference external" href="https://bottlepy.org/">bottle</a> et l'orm <a class="reference external" href="https://github.com/coleifer/peewee">peewee</a>,
qui ne m'ont jamais fait défaut.</p>
<p>Je trouve que le combo <a class="reference external" href="https://flask.palletsprojects.com/">flask</a> + <a class="reference external" href="https://www.sqlalchemy.org/">sqlalchemy</a> est une espèce
d'entre-deux qui ne correspond à aucun de mes cas d'usage.</p>
<p>Bon dev à tous !</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://dotmobo.github.io/tag/python.html">python</a>
      <a href="https://dotmobo.github.io/tag/librairies.html">librairies</a>
      <a href="https://dotmobo.github.io/tag/poetry.html">poetry</a>
      <a href="https://dotmobo.github.io/tag/black.html">black</a>
      <a href="https://dotmobo.github.io/tag/isort.html">isort</a>
      <a href="https://dotmobo.github.io/tag/pyenv.html">pyenv</a>
      <a href="https://dotmobo.github.io/tag/mypy.html">mypy</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dotmobo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Veuillez activer le JavaScript pour voir les commentaires.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy; 2018  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
Construit avec <a href="http://getpelican.com" target="_blank">Pelican</a> utilisant le thème <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a>
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://dotmobo.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " .mobo ",
  "url" : "https://dotmobo.github.io",
  "image": "//dotmobo.github.io/images/avatar700.jpg",
  "description": ".mobo - explorations d'un développeur"
}
</script>


</body>
</html>