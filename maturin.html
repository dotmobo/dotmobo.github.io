
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://dotmobo.xyz/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://dotmobo.xyz/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://dotmobo.xyz/theme/pygments/emacs.min.css">


  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://dotmobo.xyz/theme/font-awesome/css/solid.css">

    <link href="https://dotmobo.xyz/css/custom.css" rel="stylesheet">




<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68852219-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="Morgan" />
<meta name="description" content="Maturin : Booster Python avec du Rust" />
<meta name="keywords" content="maturin, pyo3, rust, python">


<meta property="og:site_name" content=".mobo"/>
<meta property="og:title" content="Maturin : Booster Python avec du Rust"/>
<meta property="og:description" content="Maturin : Booster Python avec du Rust"/>
<meta property="og:locale" content="fr_FR"/>
<meta property="og:url" content="https://dotmobo.xyz/maturin.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2025-09-01 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://dotmobo.xyz/author/morgan.html">
<meta property="article:section" content="Rust"/>
<meta property="article:tag" content="maturin"/>
<meta property="article:tag" content="pyo3"/>
<meta property="article:tag" content="rust"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="//dotmobo.xyz/images/avatar700.jpg">

  <title>.mobo &ndash; Maturin : Booster Python avec du Rust</title>

</head>
<body >
  <aside>
    <div>
      <a href="https://dotmobo.xyz">
        <img src="//dotmobo.xyz/images/avatar700.jpg" alt=".mobo" title=".mobo">
      </a>

      <h1>
        <a href="https://dotmobo.xyz">.mobo</a>
      </h1>

<p>Explorations d'un développeur</p>


      <ul class="social">
          <li>
            <a  class="sc-github" href="https://github.com/dotmobo" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/dotmobo" target="_blank">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li>
            <a  class="sc-rss" href="//dotmobo.xyz/feeds/all.atom.xml" target="_blank">
              <i class="fas fa-rss"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://dotmobo.xyz">Accueil</a>

      <a href="/categories.html">Catégories</a>
      <a href="/tags.html">Tags</a>
      <a href="/archives.html">Archives</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="maturin">Maturin : Booster Python avec du Rust</h1>
    <p>
      Posté le 01/09/2025 dans <a href="https://dotmobo.xyz/category/rust.html">Rust</a>

    </p>
  </header>


  <div>
    <img alt="Rust" class="align-right" src="./images/ferris.png" />
<p>La plupart des librairies <strong>Python</strong> actuelles qui sont à la mode comme <strong>pydantic</strong>, <strong>ruff</strong> ou <strong>uv</strong> sont écrites en
grande partie en <strong>Rust</strong> pour des raisons de performance. Mais comment ont-ils géré cette intégration ?</p>
<p>La solution se situe dans un outil ultra pratique appelé <a class="reference external" href="https://www.maturin.rs/">Maturin</a> qui permet de créer des extensions Python en Rust
de manière très simple. L'idée derrière <strong>maturin</strong> est de compiler le code Rust en librairie Python directement utilisable.</p>
<p>Un peu comme <strong>CPython</strong> qui fait du binding entre le code C et Python, <strong>PyO3</strong> (une dépendance de maturin) fait du binding entre Rust et Python.</p>
<div class="section" id="creation-d-un-projet-python">
<h2>Création d'un projet Python</h2>
<p>Tu peux commencer par créer un projet Python classique avec un environnement virtuel.</p>
<p>On va utiliser <a class="reference external" href="https://astral.sh/uv/">uv</a> qu'on a vu sur l'article précédent.</p>
<div class="highlight"><pre><span></span>uv<span class="w"> </span>init<span class="w"> </span>myrustapp<span class="w"> </span>-p<span class="w"> </span><span class="m">3</span>.13
<span class="nb">cd</span><span class="w"> </span>myrustapp
uv<span class="w"> </span>venv<span class="w"> </span>-p<span class="w"> </span><span class="m">3</span>.13
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</pre></div>
</div>
<div class="section" id="installation-de-maturin">
<h2>Installation de maturin</h2>
<p>On va maintenant installer <cite>maturin</cite> dans notre environnement virtuel.</p>
<div class="highlight"><pre><span></span>uv<span class="w"> </span>add<span class="w"> </span>maturin
</pre></div>
<p>Et c'est tout !</p>
</div>
<div class="section" id="creation-du-projet-rust">
<h2>Création du projet Rust</h2>
<p>Pour créer le projet Rust, on va utiliser <cite>maturin init</cite> qui va nous créer notre librairie Rust avec tout ce qu'il faut
dans le <strong>Cargo.toml</strong> pour faire le lien avec Python.</p>
<div class="highlight"><pre><span></span>maturin<span class="w"> </span>init<span class="w"> </span>--bindings<span class="w"> </span>pyo3<span class="w"> </span>myrustlib
<span class="nb">cd</span><span class="w"> </span>myrustlib
maturin<span class="w"> </span>develop
</pre></div>
<p>Avec <cite>maturin develop</cite>, on compile la librairie et on l'installe directement dans notre environnement virtuel.</p>
<p>Une fois le développement terminé, il vaut mieux utiliser <cite>maturin develop -r</cite> pour créer la librairie en mode release
pour de meilleures performances.</p>
<p>Il est également possible de builder et de déployer sur PyPI la librairie avec <cite>maturin build -r</cite> et <cite>maturin publish</cite>.</p>
</div>
<div class="section" id="le-code-rust">
<h2>Le code Rust</h2>
<p>Ok maintenant qu'on a notre workflow opérationnel, on va jeter un oeil au code Rust dans <strong>src/lib.rs</strong>.</p>
<div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">pyo3</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="sd">/// Formats the sum of two numbers as string.</span>
<span class="cp">#[pyfunction]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">sum_as_string</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">).</span><span class="n">to_string</span><span class="p">())</span>
<span class="p">}</span>

<span class="sd">/// A Python module implemented in Rust.</span>
<span class="cp">#[pymodule]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">myrustlib</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Bound</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">PyModule</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">wrap_pyfunction</span><span class="o">!</span><span class="p">(</span><span class="n">sum_as_string</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></div>
<p>On va rapidement détailler comme ça tu pourras le modifier et l'étendre de toi-même.</p>
<p>Les deux macros <strong>#[pyfunction]</strong> et <strong>#[pymodule]</strong> sont fournies par PyO3 pour faire le lien entre Rust et Python.</p>
<p>Pour toutes les fonctions que tu veux exposer à python, tu utiliseras <strong>#[pyfunction]</strong>.
Si tes paramètres de fonctions sont des types natifs Python (int, str, list, dict...) tu n'as rien de plus à faire.</p>
<p>Il te suffit alors d'ajouter les fonctions au module python via <strong>m.add_function</strong> dans la macro <strong>#[pymodule]</strong>.</p>
<p>Si tu veux utiliser des types Rust plus complexes, tu peux utiliser les types fournis par PyO3 comme <strong>PyList</strong> ou <strong>PyDict</strong>.</p>
<p>Et voilà, tu peux maintenant utiliser n'importe quel code Rust dans ton projet Python.
N'oublie pas de recompiler avec <cite>maturin develop -r</cite> à chaque modification.</p>
</div>
<div class="section" id="accelerer-numpy">
<h2>Accélérer numpy</h2>
<p>Pour le ML, tu peux utiliser <a class="reference external" href="https://github.com/PyO3/rust-numpy/">rust-numpy</a> qui fait le lien entre les arrays numpy et les arrays Rust.</p>
<div class="highlight"><pre><span></span><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">numpy</span><span class="p">::</span><span class="n">ndarray</span><span class="p">::{</span><span class="n">ArrayD</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayViewD</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayViewMutD</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">numpy</span><span class="p">::{</span><span class="n">IntoPyArray</span><span class="p">,</span><span class="w"> </span><span class="n">PyArrayDyn</span><span class="p">,</span><span class="w"> </span><span class="n">PyReadonlyArrayDyn</span><span class="p">,</span><span class="w"> </span><span class="n">PyArrayMethods</span><span class="p">};</span>
<span class="k">use</span><span class="w"> </span><span class="n">pyo3</span><span class="p">::{</span><span class="n">pymodule</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">::</span><span class="n">PyModule</span><span class="p">,</span><span class="w"> </span><span class="n">PyResult</span><span class="p">,</span><span class="w"> </span><span class="n">Python</span><span class="p">,</span><span class="w"> </span><span class="n">Bound</span><span class="p">};</span>

<span class="cp">#[pymodule]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">rust_ext</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_py</span><span class="p">:</span><span class="w"> </span><span class="nc">Python</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Bound</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="p">,</span><span class="w"> </span><span class="n">PyModule</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// example using immutable borrows producing a new array</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">axpy</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">ArrayViewD</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">ArrayViewD</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">ArrayD</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// example using a mutable borrow to modify an array in-place</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">mult</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">ArrayViewMutD</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// wrapper of `axpy`</span>
<span class="w">    </span><span class="cp">#[pyfn(m)]</span>
<span class="w">    </span><span class="cp">#[pyo3(name = </span><span class="s">&quot;axpy&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">axpy_py</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="n">py</span><span class="p">:</span><span class="w"> </span><span class="nc">Python</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span>
<span class="w">        </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">PyReadonlyArrayDyn</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">        </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">PyReadonlyArrayDyn</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Bound</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="p">,</span><span class="w"> </span><span class="n">PyArrayDyn</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">as_array</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">as_array</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">axpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">        </span><span class="n">z</span><span class="p">.</span><span class="n">into_pyarray</span><span class="p">(</span><span class="n">py</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// wrapper of `mult`</span>
<span class="w">    </span><span class="cp">#[pyfn(m)]</span>
<span class="w">    </span><span class="cp">#[pyo3(name = </span><span class="s">&quot;mult&quot;</span><span class="cp">)]</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">mult_py</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Bound</span><span class="o">&lt;&#39;</span><span class="na">py</span><span class="p">,</span><span class="w"> </span><span class="n">PyArrayDyn</span><span class="o">&lt;</span><span class="kt">f64</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">as_array_mut</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">mult</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></div>
<p>Dans la plupart des cas, numpy est suffisamment performant. Mais tu n'es jamais à l'abri de tomber sur un cas critique
où une petite partie de l'application nécessite un boost de performance.</p>
<p>Avec maturin, tu t'évites de devoir réécrire tout le projet en Rust pour te concentrer uniquement sur la partie concernée.</p>
</div>
<div class="section" id="quand-utiliser-rust-dans-python">
<h2>Quand utiliser Rust dans Python ?</h2>
<p>Dans la plupart des cas classiques, tu n'auras pas besoin de coder en Rust.</p>
<p>Mais dès que tu vas devoir manipuler des milliers ou millions de données, et que tu te rends compte que <strong>pandas</strong> ne suffit plus
niveau vitesse, tu pourras coder la partie critique en Rust.</p>
<p>Typiquement, toute opération de filtrage, de transformation, d'agrégation, ou de calcul sur des milliers de données
vont pouvoir être profondément accélérées. Tu vas passer de plusieurs secondes à quelques millisecondes.</p>
<p>Par exemple, je l'ai utilisé pour un projet perso pour analyser et compter le nombre de mots clés dans des milliers de
notes en excluant des stop words.</p>
<p>Le module <strong>mod stop_words</strong> ne contient qu'une liste de stop words dans différentes langues du type :</p>
<div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">STOP_WORDS</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="s">&quot;le&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;la&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;les&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;un&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;une&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;de&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;des&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;et&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;à&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en&quot;</span><span class="p">];</span>
</pre></div>
<p>Et notre fichier <strong>lib.rs</strong> complet est le suivant :</p>
<div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">pyo3</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">regex</span><span class="p">::</span><span class="n">Regex</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">serde</span><span class="p">::</span><span class="n">Deserialize</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">collections</span><span class="p">::{</span><span class="n">HashMap</span><span class="p">,</span><span class="w"> </span><span class="n">HashSet</span><span class="p">};</span>

<span class="k">mod</span><span class="w"> </span><span class="nn">stop_words</span><span class="p">;</span>

<span class="cp">#[derive(Deserialize, Debug)]</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Note</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">project</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[pyfunction]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">analyze_notes_content</span><span class="p">(</span><span class="n">notes_json</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">notes</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Note</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_str</span><span class="p">(</span><span class="n">notes_json</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PyErr</span><span class="p">::</span><span class="n">new</span><span class="p">::</span><span class="o">&lt;</span><span class="n">pyo3</span><span class="p">::</span><span class="n">exceptions</span><span class="p">::</span><span class="n">PyValueError</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Failed to parse JSON: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">total_words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">unique_projects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashSet</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">notes</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total_words</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">note</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">split_whitespace</span><span class="p">().</span><span class="n">count</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">note</span><span class="p">.</span><span class="n">project</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">unique_projects</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">note</span><span class="p">.</span><span class="n">project</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">note</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">analysis_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;Analyzed {} notes. Total word count: {}. Found {} unique projects.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">notes</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span>
<span class="w">        </span><span class="n">total_words</span><span class="p">,</span>
<span class="w">        </span><span class="n">unique_projects</span><span class="p">.</span><span class="n">len</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">analysis_result</span><span class="p">)</span>
<span class="p">}</span>

<span class="cp">#[pyfunction]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">extract_keywords</span><span class="p">(</span><span class="n">notes_json</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">top_n</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">notes</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Note</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serde_json</span><span class="p">::</span><span class="n">from_str</span><span class="p">(</span><span class="n">notes_json</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PyErr</span><span class="p">::</span><span class="n">new</span><span class="p">::</span><span class="o">&lt;</span><span class="n">pyo3</span><span class="p">::</span><span class="n">exceptions</span><span class="p">::</span><span class="n">PyValueError</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Failed to parse JSON: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">word_counts</span><span class="p">:</span><span class="w"> </span><span class="nc">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashMap</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">r&quot;[^a-zA-ZÀ-ÿ\s]&quot;</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PyErr</span><span class="p">::</span><span class="n">new</span><span class="p">::</span><span class="o">&lt;</span><span class="n">pyo3</span><span class="p">::</span><span class="n">exceptions</span><span class="p">::</span><span class="n">PyValueError</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;Failed to compile regex: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span>
<span class="w">    </span><span class="p">})</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stop_words_set</span><span class="p">:</span><span class="w"> </span><span class="nc">HashSet</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stop_words</span><span class="p">::</span><span class="n">STOP_WORDS</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cloned</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">note</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">notes</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lowercased_content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">note</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">to_lowercase</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">contraction_re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">r&quot;\b[dlcjntsqu]&#39;&quot;</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">without_contractions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contraction_re</span><span class="p">.</span><span class="n">replace_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lowercased_content</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">cleaned_content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">re</span><span class="p">.</span><span class="n">replace_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">without_contractions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cleaned_content</span><span class="p">.</span><span class="n">split_whitespace</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">stop_words_set</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">word</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Ignore single-character words</span>
<span class="w">                </span><span class="o">*</span><span class="n">word_counts</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">to_string</span><span class="p">()).</span><span class="n">or_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sorted_keywords</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word_counts</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>
<span class="w">    </span><span class="n">sorted_keywords</span><span class="p">.</span><span class="n">sort_by</span><span class="p">(</span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="mf">1.</span><span class="n">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="c1">// Sort by count, descending</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">top_keywords</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sorted_keywords</span>
<span class="w">        </span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">{}</span><span class="se">\&quot;</span><span class="s">: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span>

<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{{{}}}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">top_keywords</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)))</span>
<span class="p">}</span>

<span class="cp">#[pymodule]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">notia_analyzer</span><span class="p">(</span><span class="n">_py</span><span class="p">:</span><span class="w"> </span><span class="nc">Python</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Bound</span><span class="o">&lt;&#39;</span><span class="nb">_</span><span class="p">,</span><span class="w"> </span><span class="n">PyModule</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">wrap_pyfunction</span><span class="o">!</span><span class="p">(</span><span class="n">analyze_notes_content</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">wrap_pyfunction</span><span class="o">!</span><span class="p">(</span><span class="n">extract_keywords</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></div>
<p>À garder dans un coin de sa tête pour les projets futurs !</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://dotmobo.xyz/tag/maturin.html">maturin</a>
      <a href="https://dotmobo.xyz/tag/pyo3.html">pyo3</a>
      <a href="https://dotmobo.xyz/tag/rust.html">rust</a>
      <a href="https://dotmobo.xyz/tag/python.html">python</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dotmobo';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Veuillez activer le JavaScript pour voir les commentaires.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy; 2024  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
Construit avec <a href="http://getpelican.com" target="_blank">Pelican</a> utilisant le thème <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a>
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://dotmobo.xyz/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " .mobo ",
  "url" : "https://dotmobo.xyz",
  "image": "//dotmobo.xyz/images/avatar700.jpg",
  "description": ".mobo - explorations d'un développeur"
}
</script>


</body>
</html>