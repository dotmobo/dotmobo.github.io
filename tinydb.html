<!DOCTYPE html>
<html lang="fr">

<head>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="http://dotmobo.github.io/tinydb.html" />

    <title>  DotMobo &mdash; TinyDB, la base de données pure python
</title>



      <link type="application/atom+xml" rel="alternate" href="/feeds/all.atom.xml"  title="DotMobo Atom Feed">

    <link rel="stylesheet" href="http://dotmobo.github.io/theme/css/style.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68852219-1', 'auto');
    ga('send', 'pageview');

  </script>

    <meta name="author" content="Morgan">
    <meta name="description" content="TinyDB, la base de données pure python">
  <meta name="tags" contents="tinydb, python, base de données, bdd, nosql, ">
</head>

<body>
<header class="header">
  <div class="container">
      <div class="header-image pull-left">
        <a class="nodec" href="http://dotmobo.github.io"><img src=https://pbs.twimg.com/profile_images/559712938420760577/Hraa9PBv_200x200.jpeg></a>
      </div>
    <div class="header-inner">
      <h1 class="header-name">
        <a class="nodec" href="http://dotmobo.github.io">DotMobo</a>
      </h1>
      <h3 class="header-text">Blog d'un Pythoniste Djangonaute</h3>
      <ul class="header-menu list-inline">
          <li><a class="nodec" href="http://dotmobo.github.io/categories.html">Cat&eacute;gories</a></li>
          <li class="muted">|</li>
          <li><a class="nodec" href="http://dotmobo.github.io/tags.html">Tags</a></li>
          <li class="muted">|</li>
          <li><a class="nodec" href="http://dotmobo.github.io/archives.html">Archives</a></li>
          <li class="muted">|</li>
          <li><a class="nodec icon-github" href="https://github.com/dotmobo"></a></li>
          <li><a class="nodec icon-twitter" href="https://twitter.com/dotmobo"></a></li>
          <li><a class="nodec icon-gplus" href="https://www.google.com/+DotmoboGithubIo6"></a></li>
          <li><a class="nodec icon-rss" href="/feeds/all.atom.xml"></a></li>
      </ul>
    </div>
  </div>
</header> <!-- /.header -->  <div class="container">
  <div class="post full-post">
    <h1 class="post-title">
      <a href="/tinydb.html" title="Permalink to TinyDB, la base de données pure python">TinyDB, la base de données pure python</a>
    </h1>
    <ul class="list-inline">
      <li class="post-date">
        <a class="text-muted" href="/tinydb.html" title="2015-11-06T00:00:00+01:00">ven. 06 novembre 2015</a>
      </li>
      <li class="muted">&middot;</li>
      <li class="post-category">
        <a href="http://dotmobo.github.io/category/python.html">Python</a>
      </li>
        <li class="muted">&middot;</li>
        <li>
            <a href="/tag/tinydb.html">tinydb</a>,             <a href="/tag/python.html">python</a>,             <a href="/tag/base de données.html">base de données</a>,             <a href="/tag/bdd.html">bdd</a>,             <a href="/tag/nosql.html">nosql</a>        </li>
    </ul>
    <div class="post-content">
      <img alt="TinyDB" class="align-right" src="./images/tinydb.png" />
<p><a class="reference external" href="https://github.com/msiemens/tinydb">TinyDB</a>, ce n'est pas la base de données qui va tout révolutionner, mais
c'est le petit outil sympa à avoir à portée de main.</p>
<p>Elle est orientée <em>document</em>, comme <a class="reference external" href="https://www.mongodb.org/">MongoDB</a>, en se basant sur des fichiers <a class="reference external" href="http://www.json.org/">JSON</a>.</p>
<p>Le code est écrit en pure python, sans besoin d'aucune dépendance, et est compatible
python 2 et 3.</p>
<p>Niveau utilisation, il ne faut pas espérer des perfs de malade ; ce n'est pas fait
pour ça.</p>
<p>Par contre, si tu as besoin d'une mini BDD pour afficher des news sur
un site, ça fera l'affaire.</p>
<p>Personnellement, je l'utilise plutôt lors de la rédaction de tests unitaires,
lorsque j'ai besoin d'une batterie de données de test.</p>
<p>Pour l'utiliser, tu l'installes via <em>pip</em>:</p>
<div class="highlight"><pre>pip install tinydb
</pre></div>
<p>Tu crées, par exemple, une base de données contenant des légumes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinydb</span> <span class="kn">import</span> <span class="n">TinyDB</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyDB</span><span class="p">(</span><span class="s">&#39;meslegumes.json&#39;</span><span class="p">)</span>
</pre></div>
<p>Le fichier <em>meslegumes.json</em> correspond à ta base de données et s'est créé dans
le répertoire courant.</p>
<p>Tu crées alors une table <em>legumes</em>. Évite les caractères spéciaux dans le nom de la table,
ça peut poser problème:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;legumes&#39;</span><span class="p">)</span>
</pre></div>
<p>Tu vas maintenant insérer des légumes via la méthode <em>insert</em>:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;carotte&#39;</span><span class="p">,</span> <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;patate&#39;</span><span class="p">,</span> <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;navet&#39;</span><span class="p">,</span> <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
<p>En affichant tous les éléments de ta table, tu verras tes légumes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;carotte&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;patate&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;navet&#39;</span><span class="p">}]</span>
</pre></div>
<p>Tu peux désormais utiliser un langage de requête.
Par exemple, si tu veux récupérer toutes les carottes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinydb</span> <span class="kn">import</span> <span class="n">where</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;carotte&#39;</span><span class="p">)</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;carotte&#39;</span><span class="p">}]</span>
</pre></div>
<p>Ou tous les légumes qui sont plus de deux:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;nombre&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;carotte&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;patate&#39;</span><span class="p">}]</span>
</pre></div>
<p>Tu peux utiliser le <strong>ET</strong> et le <strong>OU</strong> logique, pour combiner tes requêtes lors
de ta recherche de légumes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">search</span><span class="p">((</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;nombre&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;nombre&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">))</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;carotte&#39;</span><span class="p">}]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">search</span><span class="p">((</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;nombre&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;nombre&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;patate&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;navet&#39;</span><span class="p">}]</span>
</pre></div>
<p>Tu peux évidemment mettre à jour tes navets:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="n">where</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;navet&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;navet&#39;</span><span class="p">)</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;navet&#39;</span><span class="p">}]</span>
</pre></div>
<p>Et supprimer tes carottes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;carotte&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;patate&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;nombre&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">u&#39;type&#39;</span><span class="p">:</span> <span class="s">u&#39;navet&#39;</span><span class="p">}]</span>
</pre></div>
<p>Ou carrément vider tous tes légumes:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">table</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="p">[]</span>
</pre></div>
<p>Voilà pour les bases! Pour un usage simple, ça devrait te suffire.</p>
<p>Il existe <a class="reference external" href="http://tinydb.readthedocs.org/en/latest/usage.html#recap">d'autres opérations</a>
pour le langage de requête comme <em>insert_multiple</em>,
<em>delete</em>, <em>increment</em>, <em>decrement</em>, <em>get</em>, <em>contains</em>, <em>count</em>.</p>
<p>Tu peux également stocker les légumes en mémoire à la place du fichier json:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinydb.storages</span> <span class="kn">import</span> <span class="n">MemoryStorage</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyDB</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">MemoryStorage</span><span class="p">)</span>
</pre></div>
<p>Et utiliser des <em>middlewares</em>, pour faire du cache par exemple:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinydb.storages</span> <span class="kn">import</span> <span class="n">JSONStorage</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinydb.middlewares</span> <span class="kn">import</span> <span class="n">CachingMiddleware</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">TinyDB</span><span class="p">(</span><span class="s">&#39;meslegumes.json&#39;</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="n">CachingMiddleware</span><span class="p">(</span><span class="n">JSONStorage</span><span class="p">))</span>
</pre></div>
<p>Enfin, il est également possible de customiser TinyDB en écrivant ton propre
<a class="reference external" href="http://tinydb.readthedocs.org/en/latest/extend.html#write-a-serializer">Serializer</a>,
ou d'écrire une <a class="reference external" href="http://tinydb.readthedocs.org/en/latest/extend.html#write-a-custom-storage">implémentation YAML</a>
pour le stockage des données à la place de JSON, ou encore d'écrire
<a class="reference external" href="http://tinydb.readthedocs.org/en/latest/extend.html#write-a-custom-middleware">tes propres Middlewares</a>.</p>

    </div>
  </div>
  <hr class="separator">
  <div class="col-md-8 col-md-offset-2">
  <div id="disqus_thread">
    <script>
      var disqus_shortname = 'dotmobo';
      (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] ||
         document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>
      Activez Javascript pour voir 
      <a href="https://disqus.com/?ref_noscript=dotmobo">
        les commentaires Disqus.
      </a>
    </noscript>
    <a href="https://disqus.com" class="dsq-brlink">
      Commentaires de blog par <span class="logo-disqus">Disqus</span>
    </a>
  </div>
  </div>
  </div>
<footer class="footer">
  <div class="container">
    <p class="text-center">
      dotmobo, <a href="https://opensource.org/licenses/MIT" target="_blank">MIT</a>.
    </p>
    <div class="text-center">
      G&eacute;n&eacute;r&eacute; par <a href="http://getpelican.com" target="_blank">Pelican</a> avec le th&egrave;me <a href="https://github.com/dotmobo/pelican-alchemy">alchemy</a>.
    </div>
  </div>
</footer> <!-- /.footer -->
  <script src="http://dotmobo.github.io/theme/js/jquery.min.js"></script>
  <script src="http://dotmobo.github.io/theme/js/bootstrap.min.js"></script>
</body> <!-- 42 -->

</html>